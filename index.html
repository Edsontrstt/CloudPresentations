<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cloud Presentations - UNMSM</title>
  <style>
    :root {
      --primary: #5D4037; /* Marr√≥n elegante */
      --secondary: #8D6E63;
    }
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }
    body {
      /* color de fondo + tu logo como imagen de fondo */
      background-color: var(--primary);
      background-image: url('images/sanmarcos_logo.png');
      background-repeat: no-repeat;
      background-position: center top;
      background-size: 200px auto;
      min-height: 100vh;
      padding-top: 120px; /* deja espacio para el logo */
    }
    .unmsm-header {
      background: white;
      padding: 1rem;
      text-align: center;
      border-bottom: 2px solid #000;
    }
    .facultad-text {
      color: #000;
      font-size: 1.2rem;
      font-weight: 500;
      letter-spacing: 1px;
    }
    header {
      background: rgba(255,255,255,0.9);
      padding: 1.5rem;
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    }
    .nav-container {
      max-width: 1200px; margin: auto;
      display: flex; justify-content: space-between; align-items: center;
    }
    .logo {
      display: flex; align-items: center; gap: 1rem;
    }
    .logo-icon {
      width: 50px; height: 50px;
    }
    .cloud-logo {
      fill: var(--primary);
    }
    .admin-btn {
      background: var(--primary);
      color: white; border: none;
      padding: .75rem 1.5rem;
      border-radius: 8px; cursor: pointer;
      transition: background .2s;
    }
    .admin-btn:hover { background: #4E342E; }
    .upload-section {
      max-width: 600px; margin: 2rem auto;
      padding: 2rem; background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: none;
    }
    .upload-section h2 { margin-bottom: 1rem; }
    .upload-section input[type="text"],
    .upload-section input[type="password"],
    .upload-section input[type="file"] {
      width: 100%; padding: .75rem;
      margin: .5rem 0; border: 1px solid #ddd;
      border-radius: 6px; font-size: 1rem;
    }
    .upload-section button {
      background: var(--secondary);
      color: white; border: none;
      padding: 1rem; border-radius: 6px;
      cursor: pointer; width: 100%;
      font-size: 1.1rem; margin-top: 1rem;
    }
    .password-container { position: relative; }
    .toggle-password {
      position: absolute; right: 10px; top: 50%;
      transform: translateY(-50%); cursor: pointer;
      color: var(--primary);
    }
    .gallery {
      max-width: 1200px; margin: 2rem auto;
      padding: 0 1rem;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px,1fr));
      gap: 1.5rem;
    }
    .card {
      background: white; border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform .2s;
    }
    .card:hover { transform: translateY(-5px); }
    .card-iframe {
      width: 100%; height: 250px; border: none;
      background: #f0f0f0;
    }
    .card-content {
      padding: 1rem;
    }
    .card-title {
      color: var(--primary); margin-bottom: .5rem;
      font-size: 1.1rem;
    }
    .card-link {
      display: inline-block; margin-top: .5rem;
      text-decoration: none; color: var(--secondary);
    }
  </style>
</head>
<body>
  <div class="unmsm-header">
    <div class="facultad-text">Facultad de Ciencias Matem√°ticas</div>
  </div>

  <header>
    <nav class="nav-container">
      <div class="logo">
        <svg class="logo-icon cloud-logo" viewBox="0 0 24 24">
          <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04
                   2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24
                   5-5 0-2.64-2.05-4.78-4.65-4.96z"/>
        </svg>
        <h1>Cloud Presentations</h1>
      </div>
      <button class="admin-btn" onclick="toggleUpload()">Modo Admin</button>
    </nav>
  </header>

  <div class="upload-section" id="uploadSection">
    <h2>Subir Contenido</h2>
    <form id="uploadForm" onsubmit="return handleUpload(event)">
      <div class="password-container">
        <input type="password" id="adminPass" placeholder="Contrase√±a de Administrador" required>
        <span class="toggle-password" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
      </div>
      <input type="text" id="presentationTitle" placeholder="T√≠tulo de la Presentaci√≥n (opcional)">
      <input type="text" id="embedCode" placeholder="URL de Google Slides (opcional)">
      <input type="file" id="fileInput" multiple>
      <button type="submit">Subir</button>
    </form>
  </div>

  <div class="gallery" id="gallery">
    <!-- Aqu√≠ se mostrar√°n presentaciones y archivos -->
  </div>

  <script>
    const ADMIN_PASSWORD = "fundamentos de programacion";

    function toggleUpload() {
      const s = document.getElementById('uploadSection');
      s.style.display = s.style.display === 'block' ? 'none' : 'block';
    }
    function togglePasswordVisibility() {
      const f = document.getElementById('adminPass');
      f.type = f.type === 'password' ? 'text' : 'password';
    }

    // Al cargar la p√°gina, recupera archivos de localStorage
    window.addEventListener('load', () => {
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('file_')) {
          const dataURL = localStorage.getItem(key);
          const name = key.replace('file_', '');
          addFileCard(name, dataURL);
        }
      }
    });

    function handleUpload(e) {
      e.preventDefault();
      if (document.getElementById('adminPass').value.toLowerCase() !== ADMIN_PASSWORD) {
        alert("Contrase√±a incorrecta");
        return false;
      }

      // 1) Procesar Google Slides si hay URL
      const title = document.getElementById('presentationTitle').value.trim();
      let embed = document.getElementById('embedCode').value.trim();
      if (embed) {
        if (embed.includes('/view')) 
          embed = embed.replace('/view', '/preview') + '?embed=true';
        addSlideCard(title || 'Presentaci√≥n', embed);
      }

      // 2) Procesar archivos
      const files = document.getElementById('fileInput').files;
      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = evt => {
          const dataURL = evt.target.result;
          // guardar en localStorage
          localStorage.setItem('file_' + file.name, dataURL);
          addFileCard(file.name, dataURL);
        };
        reader.readAsDataURL(file);
      });

      // Reset y cerrar
      e.target.reset();
      toggleUpload();
      return false;
    }

    function addSlideCard(title, src) {
      const d = document.createElement('div');
      d.className = 'card';
      d.innerHTML = `
        <iframe class="card-iframe" src="${src}" allowfullscreen></iframe>
        <div class="card-content">
          <h3 class="card-title">${title}</h3>
          <p>Fecha: ${new Date().toLocaleDateString()}</p>
        </div>`;
      document.getElementById('gallery').prepend(d);
    }

    function addFileCard(name, dataURL) {
      const d = document.createElement('div');
      d.className = 'card';
      d.innerHTML = `
        <div class="card-content">
          <h3 class="card-title">Archivo: ${name}</h3>
          <a class="card-link" href="${dataURL}" download="${name}" target="_blank">‚¨áÔ∏è Descargar / Abrir</a>
          <p>Fecha: ${new Date().toLocaleDateString()}</p>
        </div>`;
      document.getElementById('gallery').prepend(d);
    }
  </script>
</body>
</html>
